---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pagination from '../../components/Pagination.astro';

export async function getStaticPaths({ paginate }) {
  const allPosts = await Astro.glob('../../data/blog-posts/*.md');
  
  // Get unique categories/sections
  const uniqueSections = [...new Set(allPosts
    .map(post => post.frontmatter.category)
    .filter(Boolean))];
  
  // Create paths for each section and its pages
  return uniqueSections.flatMap(section => {
    // Filter posts for this section
    const sectionPosts = allPosts
      .filter(post => post.frontmatter.category === section)
      .sort((a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf());
    
    // Create paginated paths for this section
    return paginate(sectionPosts, {
      params: { section: section.toLowerCase().replace(/\s+/g, '-') },
      props: { sectionName: section },
      pageSize: 5 // Show 5 posts per page
    });
  });
}

const { page, sectionName } = Astro.props;
const { data: posts, currentPage, lastPage } = page;

const title = `Luminary ☀ | ${sectionName}`;
const description = `Latest articles in ${sectionName}`;
const permalink = `${Astro.site.href}blog/${Astro.params.section}`;
const urlBase = `/blog/${Astro.params.section}`;
---

<BaseLayout title={title} description={description} permalink={permalink} current="blog">
  <div class="container">
    <div class="section-header">
      <a href="/blog" class="back-to-blog">&larr; All Posts</a>
      <h1>{sectionName}</h1>
    </div>
    
    {posts.map((post, index) => {
      const href = `/blog/${post.file.split('/').pop().split('.').shift()}`;
      return (
        <div>
          { index !== 0 && <hr /> }
          <div class="post-item">
            {post.frontmatter.featuredImage && (
              <div class="featured-image-container">
                <img 
                  src={post.frontmatter.featuredImage} 
                  alt={post.frontmatter.title}
                  class="featured-image"
                />
              </div>
            )}
            <div class="post-content">
              <h2>
                <a href={href}>{post.frontmatter.title}</a>
              </h2>
              <p>{post.frontmatter.description}</p>
              
              <div class="post-meta">
                <span class="category">{sectionName}</span>
                
                {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
                  <div class="tags">
                    {post.frontmatter.tags.map(tag => (
                      <span class="tag">{tag}</span>
                    ))}
                  </div>
                )}
              </div>
              
              <div class="post-item-footer">
                <span class="post-item-date">— {post.frontmatter.publishDate}</span>
                <a href={href} class="read-more-btn">Continue Reading</a>
              </div>
            </div>
          </div>
        </div>
      )
    })}
    
    {posts.length === 0 && (
      <div class="no-posts">
        <p>No posts found in this section yet.</p>
        <a href="/blog" class="read-more-btn">Back to All Posts</a>
      </div>
    )}
    
    {lastPage > 1 && (
      <Pagination 
        currentPage={currentPage} 
        totalPages={lastPage} 
        urlBase={urlBase}
      />
    )}
  </div>
</BaseLayout>

<style>
  /* All your existing styles here */
</style>