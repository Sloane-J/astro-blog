---
import BaseLayout from '../../layouts/BaseLayout.astro';

// Define getStaticPaths function for dynamic routes
export async function getStaticPaths() {
  const allPosts = await Astro.glob('../../data/blog-posts/*.md');
  
  return allPosts.map((post) => {
    const slug = post.file.split('/').pop().split('.').shift();
    return {
      params: { slug },
      props: { post },
    };
  });
}

// Get the post from props passed by getStaticPaths
const { post } = Astro.props;

// Set up meta data for the blog post
const title = post.frontmatter.title;
const description = post.frontmatter.description;
const permalink = `${Astro.site.href}blog/${post.file.split('/').pop().split('.').shift()}`;
---

<BaseLayout title={title} description={description} permalink={permalink} current="blog">
  <div class="container">
    <div class="post-header">
      <h1>{post.frontmatter.title}</h1>
      <div class="post-date">
        <time datetime={post.frontmatter.publishDate}>{post.frontmatter.publishDate}</time>
      </div>
      
      <div class="post-meta">
        {post.frontmatter.category && (
          <span class="category">{post.frontmatter.category}</span>
        )}
        
        {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
          <div class="tags">
            {post.frontmatter.tags.map(tag => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )}
      </div>
    </div>
    
    {post.frontmatter.featuredImage && (
      <div class="featured-image-container">
        <img 
          src={post.frontmatter.featuredImage} 
          alt={post.frontmatter.title} 
          class="featured-image"
        />
      </div>
    )}
    
    <article class="content">
      <post.Content />
    </article>
    
    <div class="back-link">
      <a href="/blog">&larr; Back to Blog</a>
    </div>
  </div>
</BaseLayout>

<style>
  .post-header {
    margin-bottom: 2rem;
  }
  
  .post-date {
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }
  
  .featured-image-container {
    margin: 2rem 0;
  }
  
  .featured-image {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
    border-radius: 8px;
  }
  
  .post-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
  }

  .category {
    background-color: var(--primary-color, #4a6cf7);
    color: white;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.85rem;
  }

  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .tag {
    background-color: var(--tag-bg, #f5f5f5);
    color: var(--text-secondary);
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.85rem;
  }
  
  .content {
    margin: 2rem 0;
  }
  
  .back-link {
    margin-top: 3rem;
  }
  
  .back-link a {
    display: inline-block;
    padding: 0.5rem 1rem;
    color: var(--text-secondary);
    text-decoration: none;
    border: 1px solid var(--text-secondary);
    border-radius: 4px;
    transition: all 0.2s ease;
  }
  
  .back-link a:hover {
    color: var(--primary-color);
    border-color: var(--primary-color);
  }
</style>